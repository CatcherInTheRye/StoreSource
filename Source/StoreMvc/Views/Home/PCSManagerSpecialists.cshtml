@using PCSMvc.Models
@{
    ViewBag.Title = "PCSManager";
    Layout = "~/Views/Shared/_PCSManagerLayout.cshtml";
}
<div id="column-right">
    <div data-role="content">
        <div class="intelli-content">
            <div class="intelli-main-content-header ui-bar ui-bar-a">
                <a href="javascript:;" class="icoMenu" id="togglepanel"><span>Menu</span></a>
                <!--a class="ui-btn ui-nodisc-icon ui-btn-inline ui-btn-icon-left ui-btn-b ui-icon-bars ui-btn-icon-notext" href="javascript:;" id="togglepanel">Panel</a-->
                <h3>
                    Manage</h3>
            </div>
            <div class="intelli-main-content ui-body ui-body-a">
                <div class="intelli-search-field" style="position: relative; width: 95%;">
                    <input id="filterText" type="text" value="Search..." onblur="if(value=='') value = 'Search...'"
                        onfocus="if(value=='Search...') value = ''" data-role="none" class="intelli-textfield"
                        style="width: 90%;" />
                    <a id="buttonSearch" href="javascript:;" title="text matching any of the displayed columns OR Targeted search: name=|speciality=|location= will match the text only in the indicated column"
                        class="search-btn" style="right: 5px;">
                        <img src="/images/icoSearch.png" width="30" height="30" alt="" /></a>
                </div>
                <p>
                    <input id="inclustInactive" type="checkbox" value="" style="float: left; margin: 5px 10px 0;"
                        data-role="none" />
                    Include inactive
                </p>
                <p>
                    <div id="grid">
                    </div>
                </p>
                <p>
                    <a href="@Url.Action("UserUpdate")" id="addNew" class="intelli-btn-white">Add New</a>
                </p>
            </div>
        </div>
    </div>
    <!-- /content -->
</div>
@section pageJS{
    <script type="text/javascript">
        $(document).ready(function() {
            
            getCurrentData();

            $("#inclustInactive").change(function() {
                getCurrentData();
            });

            $("#buttonSearch").click(function() {
                getCurrentData();
            });
        }); //document ready
        
        function getCurrentData() {
                $.get('@(Url.Action("PCSManagerSpecialistsGet"))', { filter: getFilterText(), roleId: @((int)UserRoleEnum.Specialist), includeInactive: $("#inclustInactive:checked").length == 1 }, function(result) {
                    if (result.Result.Type == 0) {
                        createKendoGrid(result.Data);
                    }
                }, 'json');
            }
            function createKendoGrid(results) {
                    var kendoDataSource = new kendo.data.DataSource({
                        data: results,
                        schema: {
                            model: {
                                fields: {
                                    Id: { type: "number" },
                                    FullName: { type: "string" },
                                    Speciality: { type: "string" },
                                    CaseLoad: { type: "string" },
                                    Location: { type: "string" }
                                }
                            }
                        },
                        pageSize: 20
    //                    serverPaging: true,
    //                    serverFiltering: true,
    //                    serverSorting: true
                    });

                    $("#grid").kendoGrid({
                        dataSource: kendoDataSource,
                        sortable: {
                            mode: "multiple",
                            allowUnsort: true
                        },
                        pageable: true,
                        scrollable: false,
                        columns: [
                            {
                                hidden: true,
                                field: "Id",
                                attributes: { 'id': 'idCol' }
                            },
                            {
                                title: "NAME",
                                field: "FullName",
                                sortable: true,
                                width: "40%",
                                //filterable: false,
                                template: "<a href='@(Url.Action("UserUpdate"))/${Id}' title='Edit'>#:FullName#</a>"
                            },
                            {
                                title: "SPECIALITY",
                                field: "Speciality",
                                sortable: true
                            },
                            {
                                title: "CASE LOAD",
                                field: "CaseLoad",
                                sortable: true,
                                filterable: true
                            },
                            {
                                title: "PRIMARY LOCATION",
                                field: "Location",
                                sortable: true
                            },
                            {
                                width: 20,
                                template: function(dataItem) {
                                    return dataItem.Active
                                        ? "<a onclick='recordRemove(" + dataItem.Id + ")' title='Delete' class='intelli-btn-delete'><span>Delete</span></a>"
                                        : "";
                                }
                            }
                        ]
                    });
                }

            function getFilterText() {
                var result = $("#filterText").val();
                if (result == "Search...") {
                    result = "";
                }
                return result;
            }

        function recordRemove(id) {
            if (ConfirmBox("", "Remove User?")) {
                $.post("@(Url.Action("UserRemove"))", {id: id}, function (data) {
    		        if (data.Result.Type == 0) {
    		            getCurrentData();
    				}
    			}, 'json');
            }
        }
    </script>
}